<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>Clear My Path</title>

    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <style>
        body {
            margin: 0;
            background: #000;
            text-align: center;
        }
        #unity-container {
            width: 100%;
            height: 100vh;
        }
        canvas {
            width: 100%;
            height: 100%;
            background: #000;
        }
    </style>

    <!-- ðŸ”¥ Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>


    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyCV3VG5EGpjrSRTT8d_IOSiLIQ7HwG7mqU",
            authDomain: "clearmypath-b0418.firebaseapp.com",
            databaseURL: "https://clearmypath-b0418-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "clearmypath-b0418",
            storageBucket: "clearmypath-b0418.firebasestorage.app",
            messagingSenderId: "337939369632",
            appId: "1:337939369632:web:376f277decb88d0817c3c5",
            measurementId: "G-0H7BS87MB5"
        };

        firebase.initializeApp(firebaseConfig);
        
        // ðŸ” Anonymous Authentication
        let firebaseReady = false;
         firebase.auth().signInAnonymously()
        .then(() => {
            console.log("Anonymous login success");
            firebaseReady = true;
        })
        .catch((error) => {
            console.error("Auth error:", error);
        });
        
        const database = firebase.database();

        function UploadSessionToFirebase(jsonString) {

            if (!firebaseReady) {
                console.log("Firebase not ready yet, retrying...");
                
                setTimeout(function() {
                    UploadSessionToFirebase(jsonString);
                }, 1000);

                return;
            }

            firebase.database().ref("GameSessions")
                .push(JSON.parse(jsonString))
                .then(() => {
                    console.log("Session uploaded successfully.");
                })
                .catch((error) => {
                    console.error("Firebase upload error:", error);
                });
        }



      
    </script>

    <!-- Leaderboard -->
    <script>
    function FetchLeaderboardData() {

        firebase.database().ref("GameSessions").once("value")
            .then(function(snapshot) {

                if (!snapshot.exists()) {
                    unityInstance.SendMessage(
                        "LeaderboardManager",
                        "OnLeaderboardDataReceived",
                        "[]"
                    );
                    return;
                }

                let data = snapshot.val();
                let array = Object.values(data);

                window.unityInstance.SendMessage(
                    "LeaderboardManager",
                    "OnLeaderboardDataReceived",
                    JSON.stringify(array)
                );
            })
            .catch(function(error) {
                console.error("Leaderboard fetch error:", error);
            });
    }
    </script>
</head>

<body>
    <!-- Rotate Device Overlay -->
    <div id="rotateWarning" style="
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: #000;
    color: white;
    display: none;
    justify-content: center;
    align-items: center;
    flex-direction: column;
    font-family: Arial, sans-serif;
    font-size: 22px;
    z-index: 9999;
    text-align: center;
    padding: 20px;">
        <div style="font-size: 50px;">ðŸ“±</div>
        <div>Please rotate your device to landscape</div>
    </div>

    <div id="unity-container">
        <canvas id="unity-canvas"></canvas>
    </div>

    <script>
        var buildUrl = "Build";
        var loaderUrl = buildUrl + "/{{{ LOADER_FILENAME }}}";
        var config = {
            dataUrl: buildUrl + "/{{{ DATA_FILENAME }}}",
            frameworkUrl: buildUrl + "/{{{ FRAMEWORK_FILENAME }}}",
            codeUrl: buildUrl + "/{{{ CODE_FILENAME }}}",
            streamingAssetsUrl: "StreamingAssets",
            companyName: "{{{ COMPANY_NAME }}}",
            productName: "{{{ PRODUCT_NAME }}}",
            productVersion: "{{{ PRODUCT_VERSION }}}"
        };

        var canvas = document.querySelector("#unity-canvas");

        var script = document.createElement("script");
        script.src = loaderUrl;
        script.onload = () => {
            createUnityInstance(canvas, config).then((instance) => {
    window.unityInstance = instance;})
        };
        document.body.appendChild(script);
    </script>

    <script>
    window.addEventListener("beforeunload", function (e) {
        if (typeof unityInstance !== "undefined") {
            unityInstance.SendMessage("WebglJavascriptBridge", "OnBrowserClosing");
        }
    });
    </script>

    <!-- Orentation -->
        <script>
    function checkOrientation() {
        var rotateWarning = document.getElementById("rotateWarning");

        if (window.innerHeight > window.innerWidth) {
            rotateWarning.style.display = "flex";
        } else {
            rotateWarning.style.display = "none";
        }
    }

    window.addEventListener("resize", checkOrientation);
    window.addEventListener("orientationchange", checkOrientation);

    checkOrientation();
    </script>


</body>
</html>
